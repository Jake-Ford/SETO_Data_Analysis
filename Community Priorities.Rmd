---
title: "Community Priorities"
author: "Jacob Ford, Solstice Data Scientist"
date: "`r Sys.Date()`"
output: 
  rmdformats::readthedown:
    toc_depth: 5
always_allow_html: yes

knit: (function(inputFile, encoding) { 
        rmarkdown::render(inputFile, encoding = encoding, 
        output_file = file.path(dirname(inputFile), 'community_priorities.html')) })
---

```{r message=FALSE, warning=FALSE, include=FALSE}
 
  # rmdformats::readthedown:
  #    toc_depth: 5

#Load packages we'll need throughout the entire document
library(readxl)
library(sf)
library(dplyr)
library(janitor)
library(dplyr)
library(tidycensus)
library(tidyverse)
options(tigris_use_cache = TRUE)
library(nngeo)
library(plotly)
library(kableExtra)
library(haven)
library(rms)
library(rmdformats)
library(ggplot2)
library(gtsummary)
library(Statamarkdown)
library(plotly)


options(scipen = 100)


```

```{r message=FALSE, warning=FALSE, include=FALSE}

## Change the below to match your local drive ##

input_folder <- '/Volumes/GoogleDrive/Shared drives/*Solstice | Low Income Inclusion/Projects/2019-2022 DOE SETO Contract Innovations/DOE SETO Project Implementation/Project Management/SETO Data Analysis/'



setwd(input_folder)


```

```{r message=FALSE, warning=FALSE, include=FALSE}

# 1. Community Solar Priorities

survey_name = paste(input_folder,"1. Community Solar Priorities/Qualtrics Survey/seto_survey/output/QUALTRICS_survey_data_all.xlsx", sep="")

survey <- read_excel(survey_name)

# 2. Developer & Financier

dev_input = paste(input_folder, "2. Developer and Financier/", sep="")

#dev_input ='/Volumes/GoogleDrive/Shared drives/*Solstice | Low Income Inclusion/Projects/2019-2022 DOE SETO Contract Innovations/DOE SETO Project Implementation/Project Management/Developer and Financier Survey/'




# 3. Churn & Default

cd_input = paste(input_folder, "3. Churn and Default/", sep="")


#cd_input = '/Volumes/GoogleDrive/Shared drives/*Solstice | Low Income Inclusion/Projects/2019-2022 DOE SETO Contract Innovations/DOE SETO Project Implementation/Project Management/Churn & Default Analysis'




```


# Introduction

Solar power is the fastest [growing](https://www.c2es.org/content/renewable-energy/#:~:text=Renewables%20made%20up%20nearly%2020,the%20fastest%2Dgrowing%20electricity%20source.) renewable energy source. Community shared solar (CSS) projects lower the barrier to entry. This is accomplished by increasing the applicant pool by allowing those without rooftop access, such as renters or those in apartment buildings, and by lowering the financial burden of entry, as the fixed costs to install and operate the solar panels are collectivised rather than focused on one rooftop. CSS programs that are third-party owned and have participants subscribe to ongoing payments. Typically, within these programs, customers are given predefined, discrete contract terms rather than being able to compare multiple offerings or select their own terms. Our research is attempting to mimic this approach by giving customers a randomly assigned contract and surveying them on their willingness to adopt this program.

For potential customers, community solar contracts vary by their contract attributes. These include term length, cancellation fees, and potential savings rates relative to traditional utility bill companies. Given the importance of both the solar industry and the relatively incipient community solar industry, a dearth of research exists on how potential customer priorities are reflected in the likelihood of contract adoption. 

This research seeks to fill this gap by developing quantitative measurements of community priorities in likelihood of contract adoption. An original data set comprised of potential community solar customers surveyed was collected. Along with respondents demographic information, draft contracts with varying degrees of contract attributes were shown to each participant and their contract adoption rates. Using a weighted logit model, the likelihood of contract adoption was analyzed by including predictors for various demographic data and contract attributes. Additionally, relative importance is through a multinomial logit model, allowing contract attributes and demographic information to be interpreted in predictive strength relative to respective reference groups. 


## Literature Review

**to-do: to be added/folded into the Introduction to frame the macro-scope of this study**

# Methods

The community solar priorities research consists of an analysis of survey data in which each respondent was asked to evaluate two hypothetical community solar contracts with varying contract terms. Respondents also answered a number of demographic questions.

The contracts that respondents reviewed varied along the following features: (1) the program’s savings rate compared to the typical monthly electricity bill, (2) the program’s cancellation fee, (3) the contract term’s length in years, and (4) the page length of the contract.

In addition to basic descriptive analyses, the goal is to conduct two distinct analyses using the survey data. The primary analysis will use a logit model to estimate respondents’ stated willingness to enroll in the contracts they reviewed, controlling for available demographic characteristics. The secondary analysis will use an order multinomial logit model to estimate respondents’ stated willingness to enroll in a contract based on various contract terms as measured by a 5-point Likert scale.

## Data Collection

Survey respondents were drawn from two sources: (1) members of the Qualtrics panel (“the Qualtrics sample”), and (2) individuals in community groups identified by Solstice (“the Community Group sample”). Combined, these two surveys represent the primary data source. Survey responses were collected in the Qualtrics sample from April 2021 to June 2021, and resulted in 1,261 individual responses. To expand the survey population, the Community Group sample was collected from December 2021 to June 2022, with 1,022 responses. Total responses resulted in 2,283. Response quality was measured in order to detect fraud or errant submissions. After this prophylactic step, a total of 1,493 unique individuals remained, with a total of 2,986 responses as each individual reviewed two contracts. 

To make sure that enough of the respondents are from populations of interest, both of these data sources oversampled low-income respondents and people of color. To avoid biased estimates as a result of the overweighting in the survey design, survey weights are devised using state level ACS data for race. Weights are available as well for income, however due to the dynamic surveying of income used in the design of the survey weighting was opted for just race controls. Please reference the [survey weights](https://jake-ford.github.io/SETO_Data_Analysis/survey_weights.html) section for additional information. 

The population for this component of our research is adults (18+) in the eight states we will include within this study: Massachusetts, New York, California, Oregon, Illinois, Maryland, Colorado and Minnesota. We have chosen to oversample-populations that are considered low- to moderate-income (LMI) defined as up to 50% and between 50%-80% of an area’s median income, in accordance with the Department of Housing and Urban Development’s (HUD) definitions of each [term.](https://www.hudexchange.info/programs/acs-low-mod-summary-data/). Dynamic surveying was deployed in which respondents are asked whether their income falls within the LMI ranges that correspond with their zip code and household size. This is the preferred approach for this research as it allows for comparing priorities across broad income categories and avoid non- response issues attached to asking respondents to self-attest their income levels. We have also chosen to oversample minority and renter populations in this research, surpassing the proportional estimates of these demographics supplied by the 2020 American Community Survey (ACS) estimates. We have designed this sampling scheme to center familiarity with community solar as a core demographic within this research, though we will not weight on this demographic due to lack of an applicable metric. By centering familiarity with community solar as a central demographic within this research, Solstice plans to incorporate respondents that are the likely next adopters of community solar and respondents from populations that are not currently effectively reached by community solar. All demographic information will be self-attested through the community solar priorities research survey.

Full copies of the survey questions are available on the [github repository](https://github.com/Jake-Ford/SETO_Data_Analysis/tree/main/Qualtrics%20Survey). 




```{r echo=FALSE, message=FALSE, warning=FALSE}

##clean survey zip and race to match ACS categories

survey$zip <- str_pad(survey$zip, width=5, side="left", pad="0")


survey <- survey %>%
  mutate( Race = case_when(
    race_eth == "White" ~ race_eth,
    race_eth == "Black or African American" ~ race_eth,
    race_eth =="Hispanic or Latino" ~ race_eth,
    race_eth == "Asian" ~ race_eth,
    TRUE ~ "Other - POC"
  )) %>%
  mutate(zip_2 = as.integer(zip)) %>%
  mutate(state_2 = case_when(
    is.na(state) & startsWith(zip, '8') ~ "CO",
    is.na(state) & startsWith(zip, '6') ~ "IL",
    is.na(state) & startsWith(zip, '0') ~ "MA",
    is.na(state) & startsWith(zip, '2') ~ "MD",
    is.na(state) & startsWith(zip, '5') ~ "MN",
    is.na(state) & startsWith(zip, '1') ~ "NY",
    is.na(state) & startsWith(zip, '97') ~ "OR",
    is.na(state) & startsWith(zip, '9') ~ "CA",
    TRUE ~ state
  )) %>%
# drop two observations (one record) that don't have zip or state
  filter(!is.na(state_2))

survey$x_cf <- as.factor(survey$x_cf)
survey$x_sr <- factor(survey$x_sr, levels=c("5% savings rate", "10% savings rate", "20% savings rate"))


```








### Descriptive Statistics

Table 1 shows the summary statistics for both the demographic and the contract attribute data. Contract varying terms such as savings rate, cancellation fee, contract pages and contract years were evenly divided so as to evaluate contract adoption rate relative to contract differences. Contracts were randomly assigned to responsees to review. The statistics below show how in aggregate, the distribution of contract attributes remained similar to their construction. 




```{r echo=FALSE, message=FALSE, warning=FALSE}

table1_data <- survey %>% 
  select(y_signup,
         `Contract Review Order` = x_ord, 
         `Savings Rate` = x_sr, 
         `Cancellation Fee` = x_cf, 
         `Contract Length Pages` = x_clp, 
         `Contract Length Years` = x_cly, 
         `Survey Source ` = x_source, 
         `Respondent Time Spent Reviewing Contract` = x_rev,
          `Government Assistance` = x_gov, 
         `Race`=x_race, 
         `Homeowner Status` = x_hs, 
         `Income` = x_inc, 
         `Familiar with CSS` = x_fam) 

# summarize the data with our package
table1 <- tbl_summary(
  table1_data,
  by=y_signup,
  missing='no',
  ) %>% # test for a difference between groups
  modify_header(label = "**Table 1: Summary Statistics by Signup Status (No/Yes)**") %>% # update the column header
  bold_labels() %>%
  add_p()

table1%>%
  as_gt() %>%             # convert to gt table
  gt::gtsave(             # save table as image
    filename = "table1.png"
  )
```


## Demographic Comparison

Demographic data as reported in Table 1 reflects the oversampling of LMI, minority and renting communities. Graphs 1-3 show the proportion of each of these oversampled demographic categories in comparison totals. For race and income, comparison data is taken for the 8 state region from the 2020 5-year American Community Survey. Given the dynamic sampling used for income categories, control totals for income is taken from the Department of Housing and Urban Development's Office of Policy Development and Research (PD&R) Comprehensive Housing Affordability Strategy Data (CHAS). The most recent CHAS data is available as of [2018 5-year data](https://www.huduser.gov/portal/datasets/cp.html).  




### Race





```{r message=FALSE, warning=FALSE, include=FALSE}

temp <- get_acs(
  geography="state", 
  state=c("CA", "CO", "IL", "MA", "MD", "MN", "NY", "OR"),
  variables=c("White" ="B03002_003",
              "Black or African American" = "B03002_004",
              "Native American or Alaskan Native" = "B03002_005",
              "Asian" = "B03002_006",
              "Native Hawaiian or Pacific Islander" = "B03002_007",
              "Other" = "B03002_008",
              "Multiracial" = "B03002_009",
              "Hispanic or Latino" = "B03002_012"),
  year=2020, 
  geometry=FALSE)


temp_state <- temp %>%
#  filter(NAME=="California") %>%
  select(Race=variable, Total = estimate) %>%
  mutate( Race = case_when(
    Race == "White" ~ Race,
    Race == "Black or African American" ~ Race,
    Race =="Hispanic or Latino" ~ Race,
    Race == "Asian" ~ Race,
    TRUE ~ "Other - POC"
  )) %>%
  group_by(Race) %>%
  summarise(Total = sum(Total)) %>%
  arrange(Race) %>%
  mutate(Proportion = Total/sum(Total)) 


survey_race <- survey %>%
  group_by(Race=Race, .drop=FALSE) %>%
#  filter(state=="CA") %>%
  summarise(Total = n()/2) %>%
  mutate(Proportion = Total/sum(Total)) %>%
  arrange(Race)   


join_with_survey <- cbind(temp_state, survey_race)

join_with_survey <- join_with_survey[,-4]

temp_hold <- join_with_survey %>%
  select(Race=Race, Census_Total = Total, Census_Proportion = Proportion, 
         Survey_Total = Total.1, Survey_Proportion = Proportion.1) 


race_total <- temp_hold %>%
  mutate(Deserves=Census_Total/(sum(Census_Total)/sum(Survey_Total))) %>%
  mutate(Proportion_Weight = Deserves/Survey_Total,
         Population_Weight = Census_Total/Survey_Total,
         Check_Proportion_Weight = Proportion_Weight * Survey_Total,
         Check_Population_Weight=Population_Weight * Survey_Total) %>%
    arrange(-Census_Total)%>%
    adorn_totals("row")


race_total$Population_Weight[race_total$Race=="Total"] <- sum(race_total$Survey_Total[1:5] * race_total$Population_Weight[1:5])

race_total_table <- race_total %>%
  select(Race, Census_Total,Survey_Total ) %>%
  kbl(caption = "Descriptive Statistics, 8-State Region",
      digits = 3, format.args = list(big.mark = ",",scientific = FALSE)) %>%
  kable_classic(full_width = T, html_font = "Cambria") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) 


race_total_table
```




```{r echo=FALSE, message=FALSE, warning=FALSE}

survey_race_graph <- race_total %>%
  select(Race, Census = Census_Proportion, Survey = Survey_Proportion) %>%
  filter(Race !="Total")


graph_temp <- reshape2::melt(survey_race_graph, id.var='Race') 



g <- ggplot(graph_temp, aes(x=reorder(Race, -value), y=value))+geom_bar(aes(fill=variable),stat='identity', position='dodge') +theme_classic()+
  xlab('') + ylab('Proportion') + labs(color='') +   ggtitle("Race Comparison 8 State Region")+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=0.5)) +  labs(caption = "Source: 2020 ACS 5-Year, Table B03002.")

ggplotly(g)%>% 
 layout(annotations = 
 list(x = 1, y = -0.4, text = "Source: 2020 ACS 5-Year, Table B03002", 
      showarrow = F, xref='paper', yref='paper', 
      xanchor='right', yanchor='auto', xshift=0, yshift=0,
      font=list(size=11, color="Black"))
 )




```






### Income



```{r message=FALSE, warning=FALSE, include=FALSE}

under_thirty <- c('T11_est4','T11_est5','T11_est76','T11_est18','T11_est19',
                  'T11_est32','T11_est33','T11_est47','T11_est48','T11_est61','T11_est62','T11_est75',sep="|")

chas_name <- paste(input_folder, "3. Churn and Default/Central Hudson Preliminary Analysis/040/Table11.csv", sep="")

chas_data_11 <- read.csv(paste(input_folder, "3. Churn and Default/Central Hudson Preliminary Analysis/040/Table11.csv", sep=""))%>%
  filter(name %in% c("California", "Colorado", "Illinois", "Massachusetts", "Maryland",
                     "Minnesota", "New York", "Oregon")) %>%
  mutate( `1: Less than 30% AMI` = T11_est4 +T11_est5 + T11_est76 + T11_est18 + T11_est19 + 
                  T11_est32 + T11_est33 + T11_est47 + T11_est48 + T11_est61 + T11_est62 + T11_est75,
          
          `2: Between 30-50% AMI` = T11_est6+T11_est7+T11_est20+T11_est21+T11_est34+T11_est35+T11_est49+T11_est50+T11_est63+T11_est64+T11_est77+T11_est78,
          
          `3: Between 50-80% AMI` = T11_est8+
T11_est9+
T11_est10+
T11_est22+
T11_est23+
T11_est24+
T11_est36+
T11_est37+
T11_est38+
T11_est51+
T11_est52+
T11_est53+
T11_est65+
T11_est66+
T11_est67+
T11_est79+
T11_est80+
T11_est81,



        `4: Between 80-120% AMI` = T11_est11+
T11_est12+
T11_est13+
T11_est14+
T11_est25+
T11_est26+
T11_est27+
T11_est28+
T11_est39+
T11_est40+
T11_est41+
T11_est42+
T11_est54+
T11_est55+
T11_est56+
T11_est57+
T11_est68+
T11_est69+
T11_est70+
T11_est71+
T11_est82+
T11_est83+
T11_est84+
T11_est85, 

      `5: More than 120% AMI` = T11_est15+
T11_est16+
T11_est29+
T11_est30+
T11_est43+
T11_est44+
T11_est58+
T11_est59+
T11_est72+
T11_est73+
T11_est86+
T11_est87) %>%
  select(state=name,  `1: Less than 30% AMI`, `2: Between 30-50% AMI`, `3: Between 50-80% AMI`, `4: Between 80-120% AMI`,  `5: More than 120% AMI`) %>%
  adorn_totals("row")
```






```{r message=FALSE, warning=FALSE, include=FALSE}
chas_df <-reshape::melt(chas_data_11,id.var="state" )


```


```{r message=FALSE, warning=FALSE, include=FALSE}


temp_chas  <- chas_df %>%
  group_by(Income = variable) %>%
  summarise(Total = sum(value)) %>%
  arrange(Income) %>%
  mutate(Proportion = Total/sum(Total)) 


survey_income <- survey %>%
  group_by(Income=household_inc, .drop=FALSE) %>%
#  filter(state=="CA") %>%
  summarise(Total = n()/2) %>%
  mutate(Proportion = Total/sum(Total)) %>%
  arrange(Income)   


join_with_survey <- cbind(temp_chas, survey_income)

join_with_survey <- join_with_survey[,-4]

temp_hold <- join_with_survey %>%
  select(Income, Census_Total = Total, Census_Proportion = Proportion, 
         Survey_Total = Total.1, Survey_Proportion = Proportion.1) 


income_total <- temp_hold %>%
  mutate(Deserves=Census_Total/(sum(Census_Total)/sum(Survey_Total))) %>%
  mutate(Proportion_Weight = Deserves/Survey_Total,
         Population_Weight = Census_Total/Survey_Total,
         Check_Proportion_Weight = Proportion_Weight * Survey_Total,
         Check_Population_Weight=Population_Weight * Survey_Total) %>%
   # arrange(-Census_Total)%>%
    adorn_totals("row")


income_total$Population_Weight[income_total$Income=="Total"] <- sum(income_total$Survey_Total[1:5] * income_total$Population_Weight[1:5])

income_total_table <- income_total %>%
  select(Income, Census_Total,Survey_Total ) %>%
  kbl(caption = "Descriptive Statistics, 8-State Region",
      digits = 3, format.args = list(big.mark = ",",scientific = FALSE)) %>%
  kable_classic(full_width = T, html_font = "Cambria") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) 


income_total_table
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

survey_income_graph <- income_total %>%
  select(Income, Census = Census_Proportion, Survey = Survey_Proportion) %>%
  filter(Income !="Total")


graph_temp <- reshape2::melt(survey_income_graph, id.var='Income') 



g <- ggplot(graph_temp, aes(x=Income, y=value))+geom_bar(aes(fill=variable),stat='identity', position='dodge') +theme_classic()+
  xlab('') + ylab('Proportion') + labs(color='') +   ggtitle("Income Comparison 8 State Region")+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=0.5))+  labs(caption = "Source: 2018 HUD PD&R CHAS, Table 14.")


ggplotly(g)%>% 
 layout(annotations = 
 list(x = 1, y = -0.5, text = "Source: 2018 HUD PD&R CHAS, Table 14.", 
      showarrow = F, xref='paper', yref='paper', 
      xanchor='right', yanchor='auto', xshift=0, yshift=0,
      font=list(size=11, color="Black"))
 )



```





### Homeownership



```{r message=FALSE, warning=FALSE, include=FALSE}

temp <- get_acs(
  geography="state", 
  state=c("CA", "CO", "IL", "MA", "MD", "MN", "NY", "OR"),
  variables=c("01 Homeowner" ="B25003_002",
              "02 Renter" = "B25003_003"),
  year=2020, 
  geometry=FALSE)


temp_state <- temp %>%
  select(x_hs=variable, Total = estimate) %>%
  group_by(x_hs) %>%
  summarise(Total = sum(Total)) %>%
  arrange(x_hs) %>%
  mutate(Proportion = Total/sum(Total)) 


survey_race <- survey %>%
  filter(x_hs !="03 Other") %>%
  group_by(x_hs, .drop=FALSE) %>%
#  filter(state=="CA") %>%
  summarise(Total = n()/2) %>%
  mutate(Proportion = Total/sum(Total)) %>%
  arrange(x_hs)   


join_with_survey <- cbind(temp_state, survey_race)

join_with_survey <- join_with_survey[,-4]

temp_hold <- join_with_survey %>%
  select(x_hs, Census_Total = Total, Census_Proportion = Proportion, 
         Survey_Total = Total.1, Survey_Proportion = Proportion.1) 


hs_total <- temp_hold %>%
  mutate(Deserves=Census_Total/(sum(Census_Total)/sum(Survey_Total))) %>%
  mutate(Proportion_Weight = Deserves/Survey_Total,
         Population_Weight = Census_Total/Survey_Total,
         Check_Proportion_Weight = Proportion_Weight * Survey_Total,
         Check_Population_Weight=Population_Weight * Survey_Total) %>%
    arrange(-Census_Total)%>%
    adorn_totals("row")


hs_total$Population_Weight[hs_total$x_hs=="Total"] <- sum(hs_total$Survey_Total[1:3] * hs_total$Population_Weight[1:3])

race_total_table <- hs_total %>%
  select(x_hs, Census_Total,Survey_Total, Weight = Population_Weight ) %>%
  kbl(caption = "Descriptive Statistics, 8-State Region",
      digits = 3, format.args = list(big.mark = ",",scientific = FALSE)) %>%
  kable_classic(full_width = T, html_font = "Cambria") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) 


race_total_table
```




```{r echo=FALSE, message=FALSE, warning=FALSE}

survey_race_graph <- hs_total %>%
  select(x_hs, Census = Census_Proportion, Survey = Survey_Proportion) %>%
  filter(x_hs !="Total")


graph_temp <- reshape2::melt(survey_race_graph, id.var='x_hs') 



g <- ggplot(graph_temp, aes(x=reorder(x_hs, -value), y=value))+geom_bar(aes(fill=variable),stat='identity', position='dodge') +theme_classic()+
  xlab('') + ylab('Proportion') + labs(color='') +   ggtitle("Homeownership Comparison 8 State Region")+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=0.5))+  labs(caption = "Source: 2020 ACS 5-Year, Table B25003.")

ggplotly(g)%>% 
 layout(annotations = 
 list(x = 1, y = -0.25, text = "Source: 2020 ACS 5-Year, B25003.", 
      showarrow = F, xref='paper', yref='paper', 
      xanchor='right', yanchor='auto', xshift=0, yshift=0,
      font=list(size=11, color="Black"))
 )





```
















<style>
### Crosstab Graphics


{
   display: none;
 }
</style>


<style>
#### Savings Rate & Income


{
   display: none;
 }
</style>




```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
p <- ggplot(survey) +
  geom_bar(aes(x=x_sr, fill=y_signup),
           position = "dodge") +facet_wrap(~x_inc) + theme_minimal() + theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=0.5)) + xlab("")

ggplotly(p)
```
<style>
#### Savings Rate & Race

{
   display: none;
 }
</style>



```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
p <- ggplot(survey) +
  geom_bar(aes(x=x_race, fill=y_signup),
           position = "dodge") +facet_wrap(~x_sr) + theme_minimal() + theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=0.5)) + xlab("")

ggplotly(p)
```

<style>
#### Race & Income

{
   display: none;
 }
</style>


```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
p <- ggplot(survey) +
  geom_bar(aes(x=x_race, fill=y_signup),
           position = "dodge") +facet_wrap(~x_inc) + theme_minimal() + theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=0.5)) + xlab("")

ggplotly(p)
```

<style>
#### Cancellation Fee & Income

{
   display: none;
 }
</style>




```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
p <- ggplot(survey) +
  geom_bar(aes(x=factor(x_cf), fill=y_signup),
           position = "dodge") +facet_wrap(~x_inc) + theme_minimal() + theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=0.5)) + xlab("")

ggplotly(p)
```

<style>
#### Cancellation Fee & Race

{
   display: none;
 }
</style>

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
p <- ggplot(survey) +
  geom_bar(aes(x=factor(x_cf), fill=y_signup),
           position = "dodge") +facet_wrap(~x_race) + theme_minimal() + theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=0.5)) + xlab("")

ggplotly(p)
```



<style>
#### Contract Years & Income

{
   display: none;
 }
</style>



```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
p <- ggplot(survey) +
  geom_bar(aes(x=factor(x_cly), fill=y_signup),
           position = "dodge") +facet_wrap(~x_inc) + theme_minimal() + theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=0.5)) + xlab("")

ggplotly(p)
```

 

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
p <- ggplot(survey) +
  geom_bar(aes(x=factor(x_cly), fill=y_signup),
           position = "dodge") +facet_wrap(~x_race) + theme_minimal() + theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=0.5)) + xlab("")

ggplotly(p)
```









## Model


A number of independent variables will be used for both contract attributes and demographic data. Interaction variables will be tested for significant, along with a initial stepwise regression to determine which variables to initially include. The below equation is a summary of the full model used in this analysis. The dependent variable is a binary variable for contract adoption, $y_{signup}$, where 1 signifies the contract was adopted and 0 signifies it was not.  

\begin{equation}

y_{signup} = \beta_{0} + \beta_{1}x_{sr} +\beta_{2}x_{cly} +\beta_{3}x_{clp}  +\beta_{4}x_{cf} + \\  \beta_{5}x_{inc}+\beta_{6}x_{race} + \beta_{7}x_{hs} +\beta_{8}x_{fam} + \beta_{9}x_{rev} + \beta_{10}x_{ord}+ e_{i}

\end{equation}

where,


* $x_{sr}$: savings rates on monthly energy bill in contracts, listed at either 5%, 10% or 20%
* $x_{cly}$: contract length years, either 1 or 25 years
* $x_{clp}$: contract length pages, either 10 or 20 pages
* $x_{cf}$: cancellation fee, either zero or $250
* $x_{inc}$: income, listed as Low (up to 50% of AMI), Moderate (50% - 120% of AMI), or High (>120% AMI)
* $x_{race}$: Categories include Asian, Black or African American, Hispanic or Latino, White and Other POC
* $x_{hs}$: Homeowner status for Homeowner, Renter or Other
* $x_{fam}$: More or less familiar with community solar
* $x_{rev}$: How much respondent reviewed the contract; up to half the contract review is captured by "less review", over half and up to the whole contract is "more review"
* $x_{ord}$: Contract review order, likely not necessary.

Other variables of interest to consider: government program - x_govt


# Results

## Primary Analysis

From Table 1, seven models are presented analyzing changes in probability of sign up. 

### Table 1: Logistic Regression Output
```{stata echo=FALSE}


use "/Volumes/GoogleDrive/Shared drives/*Solstice | Low Income Inclusion/Projects/2019-2022 DOE SETO Contract Innovations/DOE SETO Project Implementation/Project Management/SETO Data Analysis/1. Community Solar Priorities/Qualtrics Survey/seto_survey/output/QUALTRICS_survey_data_all.dta", clear
	
	
quietly gen weight_race_int = int(weight_race)
	
eststo: quietly logit y_signup i.x_sr [pweight=weight_race_int], cluster(id)
	
eststo: quietly logit y_signup i.x_sr i.x_inc [pweight=weight_race_int], cluster(id)

eststo: quietly logit y_signup i.x_sr i.x_inc i.x_race  [pweight=weight_race_int], cluster(id)

eststo: quietly logit y_signup i.x_sr i.x_race i.x_inc i.x_hs [pweight=weight_race_int], cluster(id)

eststo: quietly logit y_signup i.x_sr i.x_race i.x_inc i.x_hs i.x_clp i.x_cly i.x_cf  [pweight=weight_race_int], cluster(id)
	
eststo: quietly logit y_signup i.x_sr i.x_race i.x_inc i.x_hs i.x_clp i.x_cly i.x_cf i.x_fam [pweight=weight_race_int], cluster(id)

eststo: quietly logit y_signup i.x_sr i.x_race i.x_inc i.x_hs i.x_clp i.x_cly i.x_cf i.x_fam i.x_rev i.x_rev [pweight=weight_race_int], cluster(id)


esttab, se label                              ///
     title(Table 1: Logistic Regression on Contract Adoption)       ///
     nonumbers mtitles("Model 1" "Model 2" "Model 3" "Model 4" "Model 5" "Model 6" "Model 7") 

eststo clear

```



### Table 2: Odds Ratios
```{stata echo=FALSE}


use "/Volumes/GoogleDrive/Shared drives/*Solstice | Low Income Inclusion/Projects/2019-2022 DOE SETO Contract Innovations/DOE SETO Project Implementation/Project Management/SETO Data Analysis/1. Community Solar Priorities/Qualtrics Survey/seto_survey/output/QUALTRICS_survey_data_all.dta", clear
	
quietly gen weight_race_int = int(weight_race)
	
eststo: quietly logit y_signup i.x_sr [pweight=weight_race_int], cluster(id)
	
eststo: quietly logit y_signup i.x_sr i.x_inc [pweight=weight_race_int], cluster(id)

eststo: quietly logit y_signup i.x_sr i.x_inc i.x_race  [pweight=weight_race_int], cluster(id)

eststo: quietly logit y_signup i.x_sr i.x_race i.x_inc i.x_hs [pweight=weight_race_int], cluster(id)

eststo: quietly logit y_signup i.x_sr i.x_race i.x_inc i.x_hs i.x_clp i.x_cly i.x_cf  [pweight=weight_race_int], cluster(id)
	
eststo: quietly logit y_signup i.x_sr i.x_race i.x_inc i.x_hs i.x_clp i.x_cly i.x_cf i.x_fam [pweight=weight_race_int], cluster(id)

eststo: quietly logit y_signup i.x_sr i.x_race i.x_inc i.x_hs i.x_clp i.x_cly i.x_cf i.x_fam i.x_rev i.x_rev [pweight=weight_race_int], cluster(id)


esttab, eform se label                              ///
     title(Table 1: Logistic Regression on Contract Adoption)       ///
     nonumbers mtitles("Model 1" "Model 2" "Model 3" "Model 4" "Model 5" "Model 6" "Model 7") 

eststo clear

```





Controlling for all other variables, contract length was found to have a strong negative relationship on the probability of contract adoption. For example, holding all variables constant, from model 5 we see that the odds ratio for contract length of 25 years is 0.82, meaning the group with contracts of 25 years are 0.82 times as likely as the group with contracts of 1 year of signing up.


No statistically significant difference in contract adoption were observed when respondents are shown differing savings rates, suggesting other attributes are primary motivations instead of savings rate. Relative to White respondents, ‘Other POC’ were 1.55 times more likely to adopt the contract in model 6, controlling for all other demographic and contract attributes.  

Moderate income individuals were more likely relative to high income individuals to accept the contract when controlling for race, contract length in both pages and years, and cancellation fees. However, by model 6, the difference is no longer statistically significant. Interestingly, in model 6 and 7, low income individuals,, were less likely to adopt the contract relative to high income and controlling for all variables








## Secondary Analysis

The secondary analysis uses a multinomial logit model to investigate the degree of which the same independent variables above influence the likert scale questions asked in the survey, including likelihood of contract adoption given differing savings rates, cancellation fees and contract lengths. Multinomial logit models are commonly utilized with outputs of interest are categorized in discrete sequences, such as a Likert scale. 




### Table 1: Savings Rates & Likelihood of Adoption



```{stata echo=FALSE}


use "/Volumes/GoogleDrive/Shared drives/*Solstice | Low Income Inclusion/Projects/2019-2022 DOE SETO Contract Innovations/DOE SETO Project Implementation/Project Management/SETO Data Analysis/1. Community Solar Priorities/Qualtrics Survey/seto_survey/output/QUALTRICS_survey_data_all.dta", clear
	

label var 	x_gov			"Government Program Usage"

gen weight_income_int = int(weight_income)
gen weight_race_int = int(weight_race)

drop if x_hs > 2 // drop the 'other category'
///

eststo: quietly	mlogit savings_none i.x_race ib3.x_inc i.x_hs	i.x_fam [fweight=weight_race_int],baseoutcome(3) cluster(id)
	
eststo: quietly	mlogit savings_1_5 i.x_race ib3.x_inc i.x_hs	i.x_fam [fweight=weight_race_int],baseoutcome(3) cluster(id)

eststo: quietly	mlogit savings_6_10 i.x_race ib3.x_inc i.x_hs	i.x_fam [fweight=weight_race_int],baseoutcome(3) cluster(id)

eststo: quietly	mlogit savings_11_15 i.x_race ib3.x_inc i.x_hs	i.x_fam [fweight=weight_race_int],baseoutcome(3) cluster(id)

//eststo: quietly	mlogit savings_16_20 i.x_race ib3.x_inc i.x_hs	i.x_fam [fweight=weight_race_int],baseoutcome(3) cluster(id)

//eststo: quietly	mlogit savings_21_50 i.x_race ib3.x_inc i.x_hs	i.x_fam [fweight=weight_race_int],baseoutcome(3) cluster(id)

//eststo: quietly	mlogit savings_50_plus i.x_race ib3.x_inc i.x_hs	i.x_fam [fweight=weight_race_int],baseoutcome(3) cluster(id)



esttab, label                                ///
     title(Logistic Regression on Contract Adoption)       ///
     nonumbers mtitles("SR: None" "SR: 1-5%" "SR: 6-10%" "SR: 11-15%") 

eststo clear


```



```{stata echo=FALSE}


use "/Volumes/GoogleDrive/Shared drives/*Solstice | Low Income Inclusion/Projects/2019-2022 DOE SETO Contract Innovations/DOE SETO Project Implementation/Project Management/SETO Data Analysis/1. Community Solar Priorities/Qualtrics Survey/seto_survey/output/QUALTRICS_survey_data_all.dta", clear
	

label var 	x_gov			"Government Program Usage"

gen weight_income_int = int(weight_income)
gen weight_race_int = int(weight_race)

drop if x_hs > 2 // drop the 'other category'
///

//eststo: quietly	mlogit savings_none i.x_race ib3.x_inc i.x_hs	i.x_fam [fweight=weight_race_int],baseoutcome(3) cluster(id)
	
//eststo: quietly	mlogit savings_1_5 i.x_race ib3.x_inc i.x_hs	i.x_fam [fweight=weight_race_int],baseoutcome(3) cluster(id)

//eststo: quietly	mlogit savings_6_10 i.x_race ib3.x_inc i.x_hs	i.x_fam [fweight=weight_race_int],baseoutcome(3) cluster(id)

//eststo: quietly	mlogit savings_11_15 i.x_race ib3.x_inc i.x_hs	i.x_fam [fweight=weight_race_int],baseoutcome(3) cluster(id)

eststo: quietly	mlogit savings_16_20 i.x_race ib3.x_inc i.x_hs	i.x_fam [fweight=weight_race_int],baseoutcome(3) cluster(id)

eststo: quietly	mlogit savings_21_50 i.x_race ib3.x_inc i.x_hs	i.x_fam [fweight=weight_race_int],baseoutcome(3) cluster(id)

eststo: quietly	mlogit savings_50_plus i.x_race ib3.x_inc i.x_hs	i.x_fam [fweight=weight_race_int],baseoutcome(3) cluster(id)



esttab, label                                ///
     title(Logistic Regression on Contract Adoption)       ///
     nonumbers mtitles("SR: 16-20%" "SR: 21-50%" "SR: >50%" ) 

eststo clear


```








## Agree/Disagree



# Discussion